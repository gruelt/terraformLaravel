# terraformLaravel

Have your .aws credentials ready !

#Deploy infra
terraform init
terraform plan
terraform apply

#deploy conf on every host
ansible-playbook -i ansible/inventory ansible/playbook.yml

#### Populate your vars

- Have a Route53 ZoneId.
- Have a wildcard certificate for the zone.
- Have a ssh key.
- Name your tags ( every instance linked will have this tag )
- Choose a "public' git repo to clone.
- Choose the number of instances in your load balancer (https and http listener  are both active)

#### Terraform plan & Terraform Apply
Be sure to check your "terraform plan" .


-A bastion for ssh connect  :  bastion.{zone.domain}
-X instances for web server ( all of them will be in the load balancer )
-RDS-Mysql database ( can be changed in instances.tf)
-Security groups
-Creates live .env file with rds conf via a template

### Ansible : deploy laravel server conf .
sh playbook.sh

If you update the number of instances , be sure to rerrun the playbook !
What ansible does:
-Install Nginx/phpfpm.
-deploy default conf and url rewrite.
-Install npm & composer
-clone a git repo ( laravel app )
-Deploy .env generated by terraform.
-installs the app dependencies : npm & composer
-Builds JS : npm run



#### Remove all

Terraform destroy

#### Todo :

Add S3 Bucket in .env parameter for persistent data

